(function(e){var k=function(g){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json&callback=".replace("__QUERY__",encodeURIComponent(g))};e.fn.lifestream=function(g){var i=this,c=jQuery.extend({classname:"lifestream",limit:10},g),a={count:c.list.length,items:[]},b=function(d){e.merge(a.items,d);a.items.sort(function(j,l){return j.date>l.date?-1:j.date===l.date?0:1});d=e('<ul class="'+c.classname+'"/>');for(var f=0,h=a.items.length<c.limit?
a.items.length:c.limit;f<h;f++)a.items[f].html&&d.append('<li class="'+c.classname+"-"+a.items[f].service+'">'+a.items[f].html+"</li>");i.html(d)};(function(){for(var d=0,f=c.list.length;d<f;d++){var h=c.list[d];e.fn.lifestream.feeds[h.service]&&e.isFunction(e.fn.lifestream.feeds[h.service])?e.fn.lifestream.feeds[h.service](h,b):e.fn.lifestream.feeds.defaultf(h,b)}})()};e.fn.lifestream.linkify=function(g){return g.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(i){return i.link(i)})};
e.fn.lifestream.feeds=e.fn.lifestream.feeds||{};e.fn.lifestream.feeds.defaultf=function(){};e.fn.lifestream.feeds.github=function(g,i){var c=function(a){var b="";if(a.type==="PushEvent"){var d="";if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])d=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];b+='<a href="'+a.url+'" title="'+d+'">pushed</a> to <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>"}else if(a.type==="CommitCommentEvent"||a.type==="IssueCommentEvent")b+=
'<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="PullRequestEvent")b+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="CreateEvent")b+="created "+a.payload.object+' <a href="'+a.url+'">'+(a.payload.object_name==="null"?a.payload.name:a.payload.object_name)+"</a>";else if(a.type==="DeleteEvent")b+="deleted "+a.payload.ref_type+
' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+'">'+a.payload.ref+"</a>";return b};e.ajax({url:k('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+g.user+'.json"'),success:function(a){if(typeof a==="string")a=e.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var d=0,f=a.query.count;d<f;d++){var h=a.query.results.json[d].json;b.push({date:new Date(h.created_at),
service:g.service,html:c(h)})}i(b)}})};e.fn.lifestream.feeds.googlereader=function(g,i){e.ajax({url:k('select * from xml where url="www.google.com/reader/public/atom/user%2F'+g.user+'%2Fstate%2Fcom.google%2Fstarred"')}).success(function(c){if(typeof c==="string")c=e.parseJSON(c);var a=[];if(c.query&&c.query.count&&c.query.count>0){c=c.query.results.feed.entry;for(var b=0,d=c.length;b<d;b++){var f=c[b];a.push({date:new Date(parseInt(f["crawl-timestamp-msec"],10)),service:g.service,html:'starred post <a href="'+
f.link.href+'">'+f.title.content+"</a>"})}}i(a)})};e.fn.lifestream.feeds.stackoverflow=function(g,i){var c=function(a){var b="",d="",f="",h="",j="http://stackoverflow.com/users/"+g.user;if(a.timeline_type==="badge"){d=a.timeline_type+" "+a.action+": "+a.description;f=a.detail;h=j+"?tab=reputation"}else if(a.timeline_type==="revision"||a.timeline_type==="accepted"||a.timeline_type==="askoranswered"){d=a.post_type+" "+a.action;f=a.detail||a.description||"";h="http://stackoverflow.com/questions/"+a.post_id}b+=
'<a href="'+h+'" title="'+f+'">'+d+"</a>";return b};e.fn.lifestream.feeds.stackoverflow.parseStackOverflow=function(a){var b=[];if(a&&a.total&&a.total>0&&a.user_timelines)for(var d=0,f=a.user_timelines.length;d<f;d++){var h=a.user_timelines[d];b.push({date:new Date(h.creation_date*1E3),service:g.service,html:c(h)})}i(b)};e.ajax({url:"http://api.stackoverflow.com/1.1/users/"+g.user+"/timeline?jsonp=$.fn.lifestream.feeds.stackoverflow.parseStackOverflow",dataType:"jsonp",crossDomain:true}).complete(i)};
e.fn.lifestream.feeds.twitter=function(g,i){var c=function(a){return e.fn.lifestream.linkify(a).replace(/#([A-Za-z0-9\/\.]*)/g,function(b){return'<a target="_new" href="http://twitter.com/search?q='+b.replace("#","%23")+'">'+b+"</a>"}).replace(/@[\w]+/g,function(b){return'<a href="http://www.twitter.com/'+b.replace("@","")+'">'+b+"</a>"})};e.ajax({url:k('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+g.user+'"')}).success(function(a){if(typeof a===
"string")a=e.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var d=0,f=a.query.count;d<f;d++){var h=a.query.results.statuses[d].status;b.push({date:new Date(h.created_at),service:g.service,html:c(h.text)})}i(b)})};e.fn.lifestream.feeds.youtube=function(g,i){e.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+g.user+"/favorites?v=2&alt=jsonc"}).success(function(c){if(typeof c==="string")c=e.parseJSON(c);c=c;var a=[];if(c.data&&c.data.items)for(var b=0,d=c.data.items.length;b<
d;b++){var f=c.data.items[b];a.push({date:new Date(f.created),service:g.service,html:' favorited <a href="'+f.video.player["default"]+'" title="'+f.video.description+'">'+f.video.title+"</a>"})}i(a)})}})(jQuery);
