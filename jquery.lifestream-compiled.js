(function(b){var k=function(f){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json&callback=".replace("__QUERY__",encodeURIComponent(f))};b.fn.lifestream=function(f){var i=this,h=jQuery.extend({classname:"lifestream",limit:10},f);b.fn.lifestream.data={};b.fn.lifestream.data={count:h.list.length,items:[]};var c=function(){b.fn.lifestream.data.count--;if(b.fn.lifestream.data.count===0){b.fn.lifestream.data.items.sort(function(g,j){return g.date>
j.date?-1:g.date===j.date?0:1});for(var a=b('<ul class="'+h.classname+'"/>'),d=0,e=b.fn.lifestream.data.items.length<h.limit?b.fn.lifestream.data.items.length:h.limit;d<e;d++)b.fn.lifestream.data.items[d].html&&a.append('<li class="'+h.classname+"-"+b.fn.lifestream.data.items[d].service+'">'+b.fn.lifestream.data.items[d].html+"</li>");i.html(a);b.fn.lifestream.data={count:h.list.length,items:[]}}};(function(){for(var a=0,d=b.fn.lifestream.data.count;a<d;a++){var e=h.list[a];b.fn.lifestream.feeds[e.service]&&
b.isFunction(b.fn.lifestream.feeds[e.service])?b.fn.lifestream.feeds[e.service](e,c):b.fn.lifestream.feeds.defaultf(e,c)}})()};b.fn.lifestream.linkify=function(f){return f.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(i){return i.link(i)})};b.fn.lifestream.feeds=b.fn.lifestream.feeds||{};b.fn.lifestream.feeds.twitter=function(f,i){var h=function(a){return b.fn.lifestream.linkify(a).replace(/#([A-Za-z0-9\/\.]*)/g,function(d){return'<a target="_new" href="http://twitter.com/search?q='+
d.replace("#","%23")+'">'+d+"</a>"}).replace(/@[\w]+/g,function(d){return'<a href="http://www.twitter.com/'+d.replace("@","")+'">'+d+"</a>"})},c=function(a){var d=[];if(a.query&&a.query.count&&a.query.count>0)for(var e=0,g=a.query.count;e<g;e++){var j=a.query.results.statuses[e].status;d.push({date:new Date(j.created_at),service:f.service,html:h(j.text)})}return d};b.ajax({url:k('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+f.user+'"')}).success(function(a){if(typeof a===
"string")a=b.parseJSON(a);b.merge(b.fn.lifestream.data.items,c(a))}).complete(i)};b.fn.lifestream.feeds.github=function(f,i){var h=function(a){var d="";if(a.type==="PushEvent"){var e="";if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])e=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];d+='<a href="'+a.url+'" title="'+e+'">pushed</a> to <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>"}else if(a.type==="CommitCommentEvent"||a.type==="IssueCommentEvent")d+=
'<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="PullRequestEvent")d+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="CreateEvent")d+="created "+a.payload.object+' <a href="'+a.url+'">'+(a.payload.object_name==="null"?a.payload.name:a.payload.object_name)+"</a>";else if(a.type==="DeleteEvent")d+="deleted "+a.payload.ref_type+
' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+'">'+a.payload.ref+"</a>";return d},c=function(a){var d=[];if(a.query&&a.query.count&&a.query.count>0)for(var e=0,g=a.query.count;e<g;e++){var j=a.query.results.json[e].json;d.push({date:new Date(j.created_at),service:f.service,html:h(j)})}return d};b.ajax({url:k('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+f.user+'.json"'),success:function(a){if(typeof a===
"string")a=b.parseJSON(a);b.merge(b.fn.lifestream.data.items,c(a))},complete:i})};b.fn.lifestream.feeds.stackoverflow=function(f,i){var h=function(c){var a="",d="",e="",g="",j="http://stackoverflow.com/users/"+f.user;if(c.timeline_type==="badge"){d=c.timeline_type+" "+c.action+": "+c.description;e=c.detail;g=j+"?tab=reputation"}else if(c.timeline_type==="revision"||c.timeline_type==="accepted"||c.timeline_type==="askoranswered"){d=c.post_type+" "+c.action;e=c.detail||c.description||"";g="http://stackoverflow.com/questions/"+
c.post_id}a+='<a href="'+g+'" title="'+e+'">'+d+"</a>";return a};b.fn.lifestream.feeds.stackoverflow.parseStackOverflow=function(c){var a=[];if(c&&c.total&&c.total>0&&c.user_timelines)for(var d=0,e=c.user_timelines.length;d<e;d++){var g=c.user_timelines[d];a.push({date:new Date(g.creation_date*1E3),service:f.service,html:h(g)})}b.merge(b.fn.lifestream.data.items,a)};b.ajax({url:"http://api.stackoverflow.com/1.1/users/"+f.user+"/timeline?jsonp=$.fn.lifestream.feeds.stackoverflow.parseStackOverflow",
dataType:"jsonp",crossDomain:true}).complete(i)};b.fn.lifestream.feeds.googlereader=function(f,i){var h=function(c){var a=[];if(c.query&&c.query.count&&c.query.count>0){c=c.query.results.feed.entry;for(var d=0,e=c.length;d<e;d++){var g=c[d];a.push({date:new Date(parseInt(g["crawl-timestamp-msec"],10)),service:f.service,html:'starred post <a href="'+g.link.href+'">'+g.title.content+"</a>"})}}return a};b.ajax({url:k('select * from xml where url="www.google.com/reader/public/atom/user%2F'+f.user+'%2Fstate%2Fcom.google%2Fstarred"')}).success(function(c){if(typeof c===
"string")c=b.parseJSON(c);b.merge(b.fn.lifestream.data.items,h(c))}).complete(i)};b.fn.lifestream.feeds.defaultf=function(){}})(jQuery);
