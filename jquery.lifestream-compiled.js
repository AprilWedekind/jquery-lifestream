(function(g){var o=function(h){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json&callback=".replace("__QUERY__",encodeURIComponent(h))};g.fn.lifestream=function(h){var i=this,e=jQuery.extend({classname:"lifestream",limit:10},h),a={count:e.list.length,items:[]},c=function(d){g.merge(a.items,d);a.items.sort(function(k,j){return k.date>j.date?-1:k.date===j.date?0:1});d=g('<ul class="'+e.classname+'"/>');for(var b=0,f=a.items.length<e.limit?
a.items.length:e.limit;b<f;b++)a.items[b].html&&d.append('<li class="'+e.classname+"-"+a.items[b].service+'">'+a.items[b].html+"</li>");i.html(d)};(function(){for(var d=0,b=e.list.length;d<b;d++){var f=e.list[d];g.fn.lifestream.feeds[f.service]&&g.isFunction(g.fn.lifestream.feeds[f.service])&&g.fn.lifestream.feeds[f.service](f,c)}})()};g.fn.lifestream.linkify=function(){var h=RegExp("(?:\\b[a-z\\d.-]+://[^<>\\s]+|\\b(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:[;/][^#?<>\\s]*)?(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w)|(?:mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w))",
"ig"),i=/^[a-z\d.-]+:\/\//i,e={"'":"`",">":"<",")":"(","]":"[","}":"{","\u00bb":"\u00ab","\u203a":"\u2039"},a={callback:function(c,d){return d?'<a href="'+d+'" title="'+d+'">'+c+"</a>":c},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(c,d){d=d||{};var b,f,k="",j=[],p,m,q,n,l;for(b in a)if(d[b]===undefined)d[b]=a[b];for(;b=h.exec(c);){b=b[0];m=h.lastIndex;q=m-b.length;if(!/[\/:]/.test(c.charAt(q-1))){do{f=b;l=b.substr(-1);if(n=e[l]){n=b.match(RegExp("\\"+
n+"(?!$)","g"));l=b.match(RegExp("\\"+l,"g"));if((n?n.length:0)<(l?l.length:0)){b=b.substr(0,b.length-1);m--}}if(d.punct_regexp)b=b.replace(d.punct_regexp,function(r){m-=r.length;return""})}while(b.length&&b!==f);f=b;i.test(f)||(f=(f.indexOf("@")!==-1?!f.indexOf("mailto:")?"":"mailto:":!f.indexOf("irc.")?"irc://":!f.indexOf("ftp.")?"ftp://":"http://")+f);if(p!=q){j.push([c.slice(p,q)]);p=m}j.push([b,f])}}j.push([c.substr(p)]);for(b=0;b<j.length;b++)k+=d.callback.apply(window,j[b]);return k||c}}();
g.fn.lifestream.feeds=g.fn.lifestream.feeds||{};g.fn.lifestream.feeds.delicious=function(h,i){var e=function(a){var c="";c+='added bookmark <a href="'+a.u+'">'+a.d+"</a>";return c};g.fn.lifestream.feeds.delicious.parseDelious=function(a){var c=[];if(a&&a.length&&a.length>0)for(var d=0,b=a.length;d<b;d++){var f=a[d];c.push({date:new Date(f.dt),service:h.service,html:e(f)})}i(c)};g.ajax({url:"http://feeds.delicious.com/v2/json/"+h.user+"/?callback=$.fn.lifestream.feeds.delicious.parseDelious",dataType:"jsonp",
crossDomain:true})};g.fn.lifestream.feeds.flickr=function(h,i){g.fn.lifestream.feeds.flickr.parseFlickr=function(e){var a=[];if(e&&e.items&&e.items.length>0)for(var c=0,d=e.items.length;c<d;c++){var b=e.items[c];a.push({date:new Date(b.published),service:h.service,html:'posted a photo <a href="'+b.link+'">'+b.title+"</a>"})}i(a)};g.ajax({url:"http://api.flickr.com/services/feeds/photos_public.gne?id="+h.user+"&lang=en-us&format=json&jsoncallback=jQuery.fn.lifestream.feeds.flickr.parseFlickr",dataType:"jsonp",
crossDomain:true})};g.fn.lifestream.feeds.github=function(h,i){var e=function(a){var c="";if(a.type==="PushEvent"){var d="";if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])d=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];c+='<a href="'+a.url+'" title="'+d+'">pushed</a> to <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>"}else if(a.type==="CommitCommentEvent"||a.type==="IssueCommentEvent")c+='<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+
a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="PullRequestEvent")c+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="CreateEvent")c+="created "+a.payload.object+' <a href="'+a.url+'">'+(a.payload.object_name==="null"?a.payload.name:a.payload.object_name)+"</a>";else if(a.type==="DeleteEvent")c+="deleted "+a.payload.ref_type+' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+
'">'+a.payload.ref+"</a>";return c};g.ajax({url:o('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+h.user+'.json"'),success:function(a){if(typeof a==="string")a=g.parseJSON(a);a=a;var c=[];if(a.query&&a.query.count&&a.query.count>0)for(var d=0,b=a.query.count;d<b;d++){var f=a.query.results.json[d].json;c.push({date:new Date(f.created_at),service:h.service,html:e(f)})}i(c)}})};g.fn.lifestream.feeds.googlereader=
function(h,i){g.ajax({url:o('select * from xml where url="www.google.com/reader/public/atom/user%2F'+h.user+'%2Fstate%2Fcom.google%2Fstarred"')}).success(function(e){if(typeof e==="string")e=g.parseJSON(e);var a=[];if(e.query&&e.query.count&&e.query.count>0){e=e.query.results.feed.entry;for(var c=0,d=e.length;c<d;c++){var b=e[c];a.push({date:new Date(parseInt(b["crawl-timestamp-msec"],10)),service:h.service,html:'starred post <a href="'+b.link.href+'">'+b.title.content+"</a>"})}}i(a)})};g.fn.lifestream.feeds.lastfm=
function(h,i){var e=function(a){var c="";c+='loved <a href="'+a.url+'">'+a.name+'</a> by <a href="'+a.artist.url+'">'+a.artist.name+"</a>";return c};g.ajax({url:o('select * from xml where url="http://ws.audioscrobbler.com/2.0/user/'+h.user+'/lovedtracks.xml"')}).success(function(a){if(typeof a==="string")a=g.parseJSON(a);var c=[];if(a.query&&a.query.count&&a.query.count>0&&a.query.results.lovedtracks&&a.query.results.lovedtracks.track){a=a.query.results.lovedtracks.track;for(var d=0,b=a.length;d<
b;d++){var f=a[d];c.push({date:new Date(parseInt(f.date.uts*1E3,10)),service:h.service,html:e(f)})}}i(c)})};g.fn.lifestream.feeds.stackoverflow=function(h,i){var e=function(a){var c="",d="",b="",f="",k="http://stackoverflow.com/users/"+h.user;if(a.timeline_type==="badge"){d=a.timeline_type+" "+a.action+": "+a.description;b=a.detail;f=k+"?tab=reputation"}else if(a.timeline_type==="revision"||a.timeline_type==="comment"||a.timeline_type==="accepted"||a.timeline_type==="askoranswered"){d=a.post_type+
" "+a.action;b=a.detail||a.description||"";f="http://stackoverflow.com/questions/"+a.post_id}c+='<a href="'+f+'" title="'+b+'">'+d+"</a> - "+b;return c};g.fn.lifestream.feeds.stackoverflow.parseStackOverflow=function(a){var c=[];if(a&&a.total&&a.total>0&&a.user_timelines)for(var d=0,b=a.user_timelines.length;d<b;d++){var f=a.user_timelines[d];c.push({date:new Date(f.creation_date*1E3),service:h.service,html:e(f)})}i(c)};g.ajax({url:"http://api.stackoverflow.com/1.1/users/"+h.user+"/timeline?jsonp=$.fn.lifestream.feeds.stackoverflow.parseStackOverflow",
dataType:"jsonp",crossDomain:true})};g.fn.lifestream.feeds.twitter=function(h,i){var e=function(a){return g.fn.lifestream.linkify(a).replace(/ #([A-Za-z0-9\/\.]*)/g,function(c){return' <a target="_new" href="http://twitter.com/search?q='+c.replace(" #","%23")+'">'+c+"</a>"}).replace(/@[\w]+/g,function(c){return'<a href="http://www.twitter.com/'+c.replace("@","")+'">'+c+"</a>"})};g.ajax({url:o('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+h.user+
'"')}).success(function(a){if(typeof a==="string")a=g.parseJSON(a);a=a;var c=[];if(a.query&&a.query.count&&a.query.count>0)for(var d=0,b=a.query.count;d<b;d++){var f=a.query.results.statuses[d].status;c.push({date:new Date(f.created_at),service:h.service,html:e(f.text)})}i(c)})};g.fn.lifestream.feeds.youtube=function(h,i){g.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+h.user+"/favorites?v=2&alt=jsonc"}).success(function(e){if(typeof e==="string")e=g.parseJSON(e);e=e;var a=[];if(e.data&&e.data.items)for(var c=
0,d=e.data.items.length;c<d;c++){var b=e.data.items[c];a.push({date:new Date(b.created),service:h.service,html:' favorited <a href="'+b.video.player["default"]+'" title="'+b.video.description+'">'+b.video.title+"</a>"})}i(a)})}})(jQuery);
