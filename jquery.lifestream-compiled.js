(function(e){var j=function(g){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json&callback=".replace("__QUERY__",encodeURIComponent(g))};e.fn.lifestream=function(g){var i=this,d=jQuery.extend({classname:"lifestream",limit:10},g),a={count:d.list.length,items:[]},b=function(c){e.merge(a.items,c);a.items.sort(function(k,l){return k.date>l.date?-1:k.date===l.date?0:1});c=e('<ul class="'+d.classname+'"/>');for(var f=0,h=a.items.length<d.limit?
a.items.length:d.limit;f<h;f++)a.items[f].html&&c.append('<li class="'+d.classname+"-"+a.items[f].service+'">'+a.items[f].html+"</li>");i.html(c)};(function(){for(var c=0,f=d.list.length;c<f;c++){var h=d.list[c];e.fn.lifestream.feeds[h.service]&&e.isFunction(e.fn.lifestream.feeds[h.service])?e.fn.lifestream.feeds[h.service](h,b):e.fn.lifestream.feeds.defaultf(h,b)}})()};e.fn.lifestream.linkify=function(g){return g.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(i){return i.link(i)})};
e.fn.lifestream.feeds=e.fn.lifestream.feeds||{};e.fn.lifestream.feeds.defaultf=function(){};e.fn.lifestream.feeds.delicious=function(g,i){var d=function(a){var b="";b+='added bookmark <a href="'+a.u+'">'+a.d+"</a>";return b};e.fn.lifestream.feeds.delicious.parseDelious=function(a){var b=[];if(a&&a.length&&a.length>0)for(var c=0,f=a.length;c<f;c++){var h=a[c];b.push({date:new Date(h.dt),service:g.service,html:d(h)})}i(b)};e.ajax({url:"http://feeds.delicious.com/v2/json/"+g.user+"/?callback=$.fn.lifestream.feeds.delicious.parseDelious",
success:function(a){if(typeof a==="string")a=e.parseJSON(a);i(parseDelicious(a))},dataType:"jsonp",crossDomain:true})};e.fn.lifestream.feeds.github=function(g,i){var d=function(a){var b="";if(a.type==="PushEvent"){var c="";if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])c=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];b+='<a href="'+a.url+'" title="'+c+'">pushed</a> to <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>"}else if(a.type==="CommitCommentEvent"||
a.type==="IssueCommentEvent")b+='<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="PullRequestEvent")b+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="CreateEvent")b+="created "+a.payload.object+' <a href="'+a.url+'">'+(a.payload.object_name==="null"?a.payload.name:a.payload.object_name)+"</a>";else if(a.type==="DeleteEvent")b+=
"deleted "+a.payload.ref_type+' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+'">'+a.payload.ref+"</a>";return b};e.ajax({url:j('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+g.user+'.json"'),success:function(a){if(typeof a==="string")a=e.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var c=0,f=a.query.count;c<f;c++){var h=a.query.results.json[c].json;b.push({date:new Date(h.created_at),
service:g.service,html:d(h)})}i(b)}})};e.fn.lifestream.feeds.googlereader=function(g,i){e.ajax({url:j('select * from xml where url="www.google.com/reader/public/atom/user%2F'+g.user+'%2Fstate%2Fcom.google%2Fstarred"')}).success(function(d){if(typeof d==="string")d=e.parseJSON(d);var a=[];if(d.query&&d.query.count&&d.query.count>0){d=d.query.results.feed.entry;for(var b=0,c=d.length;b<c;b++){var f=d[b];a.push({date:new Date(parseInt(f["crawl-timestamp-msec"],10)),service:g.service,html:'starred post <a href="'+
f.link.href+'">'+f.title.content+"</a>"})}}i(a)})};e.fn.lifestream.feeds.lastfm=function(g,i){var d=function(a){var b="";b+='loved <a href="'+a.url+'">'+a.name+'</a> by <a href="'+a.artist.url+'">'+a.artist.name+"</a>";return b};e.ajax({url:j('select * from xml where url="http://ws.audioscrobbler.com/2.0/user/'+g.user+'/lovedtracks.xml"')}).success(function(a){if(typeof a==="string")a=e.parseJSON(a);var b=[];if(a.query&&a.query.count&&a.query.count>0&&a.query.results.lovedtracks&&a.query.results.lovedtracks.track){a=
a.query.results.lovedtracks.track;for(var c=0,f=a.length;c<f;c++){var h=a[c];b.push({date:new Date(parseInt(h.date.uts*1E3,10)),service:g.service,html:d(h)})}}i(b)})};e.fn.lifestream.feeds.stackoverflow=function(g,i){var d=function(a){var b="",c="",f="",h="",k="http://stackoverflow.com/users/"+g.user;if(a.timeline_type==="badge"){c=a.timeline_type+" "+a.action+": "+a.description;f=a.detail;h=k+"?tab=reputation"}else if(a.timeline_type==="revision"||a.timeline_type==="accepted"||a.timeline_type===
"askoranswered"){c=a.post_type+" "+a.action;f=a.detail||a.description||"";h="http://stackoverflow.com/questions/"+a.post_id}b+='<a href="'+h+'" title="'+f+'">'+c+"</a>";return b};e.fn.lifestream.feeds.stackoverflow.parseStackOverflow=function(a){var b=[];if(a&&a.total&&a.total>0&&a.user_timelines)for(var c=0,f=a.user_timelines.length;c<f;c++){var h=a.user_timelines[c];b.push({date:new Date(h.creation_date*1E3),service:g.service,html:d(h)})}i(b)};e.ajax({url:"http://api.stackoverflow.com/1.1/users/"+
g.user+"/timeline?jsonp=$.fn.lifestream.feeds.stackoverflow.parseStackOverflow",dataType:"jsonp",crossDomain:true})};e.fn.lifestream.feeds.twitter=function(g,i){var d=function(a){return e.fn.lifestream.linkify(a).replace(/#([A-Za-z0-9\/\.]*)/g,function(b){return'<a target="_new" href="http://twitter.com/search?q='+b.replace("#","%23")+'">'+b+"</a>"}).replace(/@[\w]+/g,function(b){return'<a href="http://www.twitter.com/'+b.replace("@","")+'">'+b+"</a>"})};e.ajax({url:j('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+
g.user+'"')}).success(function(a){if(typeof a==="string")a=e.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var c=0,f=a.query.count;c<f;c++){var h=a.query.results.statuses[c].status;b.push({date:new Date(h.created_at),service:g.service,html:d(h.text)})}i(b)})};e.fn.lifestream.feeds.youtube=function(g,i){e.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+g.user+"/favorites?v=2&alt=jsonc"}).success(function(d){if(typeof d==="string")d=e.parseJSON(d);d=d;var a=[];if(d.data&&
d.data.items)for(var b=0,c=d.data.items.length;b<c;b++){var f=d.data.items[b];a.push({date:new Date(f.created),service:g.service,html:' favorited <a href="'+f.video.player["default"]+'" title="'+f.video.description+'">'+f.video.title+"</a>"})}i(a)})}})(jQuery);
