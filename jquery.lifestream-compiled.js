(function(d){var k=function(h){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json&callback=".replace("__QUERY__",encodeURIComponent(h))};d.fn.lifestream=function(h){var i=this,e=jQuery.extend({classname:"lifestream",limit:10},h),a={count:e.list.length,items:[]},b=function(c){d.merge(a.items,c);a.items.sort(function(j,l){return j.date>l.date?-1:j.date===l.date?0:1});c=d('<ul class="'+e.classname+'"/>');for(var f=0,g=a.items.length<e.limit?
a.items.length:e.limit;f<g;f++)a.items[f].html&&c.append('<li class="'+e.classname+"-"+a.items[f].service+'">'+a.items[f].html+"</li>");i.html(c)};(function(){for(var c=0,f=a.count;c<f;c++){var g=e.list[c];d.fn.lifestream.feeds[g.service]&&d.isFunction(d.fn.lifestream.feeds[g.service])?d.fn.lifestream.feeds[g.service](g,b):d.fn.lifestream.feeds.defaultf(g,b)}})()};d.fn.lifestream.linkify=function(h){return h.replace(/[A-Za-z]+:\/\/[A-Za-z0-9-_]+\.[A-Za-z0-9-_:%&\?\/.=]+/,function(i){return i.link(i)})};
d.fn.lifestream.feeds=d.fn.lifestream.feeds||{};d.fn.lifestream.feeds.twitter=function(h,i){var e=function(a){return d.fn.lifestream.linkify(a).replace(/#([A-Za-z0-9\/\.]*)/g,function(b){return'<a target="_new" href="http://twitter.com/search?q='+b.replace("#","%23")+'">'+b+"</a>"}).replace(/@[\w]+/g,function(b){return'<a href="http://www.twitter.com/'+b.replace("@","")+'">'+b+"</a>"})};d.ajax({url:k('select status.id, status.created_at, status.text from twitter.user.timeline where screen_name="'+
h.user+'"')}).success(function(a){if(typeof a==="string")a=d.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var c=0,f=a.query.count;c<f;c++){var g=a.query.results.statuses[c].status;b.push({date:new Date(g.created_at),service:h.service,html:e(g.text)})}i(b)})};d.fn.lifestream.feeds.github=function(h,i){var e=function(a){var b="";if(a.type==="PushEvent"){var c="";if(a.payload&&a.payload.shas&&a.payload.shas.json&&a.payload.shas.json[2])c=a.payload.shas.json[2]+" by "+a.payload.shas.json[3];
b+='<a href="'+a.url+'" title="'+c+'">pushed</a> to <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>"}else if(a.type==="CommitCommentEvent"||a.type==="IssueCommentEvent")b+='<a href="'+a.url+'">commented</a> on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="PullRequestEvent")b+='<a href="'+a.url+'">'+a.payload.action+'</a> pull request on <a href="http://github.com/'+a.payload.repo+'">'+a.payload.repo+"</a>";else if(a.type==="CreateEvent")b+=
"created "+a.payload.object+' <a href="'+a.url+'">'+(a.payload.object_name==="null"?a.payload.name:a.payload.object_name)+"</a>";else if(a.type==="DeleteEvent")b+="deleted "+a.payload.ref_type+' <a href="http://github.com/'+a.repository.owner+"/"+a.repository.name+'">'+a.payload.ref+"</a>";return b};d.ajax({url:k('select json.repository.owner,json.repository.name,json.payload,json.type,json.url, json.created_at from json where url="http://github.com/'+h.user+'.json"'),success:function(a){if(typeof a===
"string")a=d.parseJSON(a);a=a;var b=[];if(a.query&&a.query.count&&a.query.count>0)for(var c=0,f=a.query.count;c<f;c++){var g=a.query.results.json[c].json;b.push({date:new Date(g.created_at),service:h.service,html:e(g)})}i(b)}})};d.fn.lifestream.feeds.stackoverflow=function(h,i){var e=function(a){var b="",c="",f="",g="",j="http://stackoverflow.com/users/"+h.user;if(a.timeline_type==="badge"){c=a.timeline_type+" "+a.action+": "+a.description;f=a.detail;g=j+"?tab=reputation"}else if(a.timeline_type===
"revision"||a.timeline_type==="accepted"||a.timeline_type==="askoranswered"){c=a.post_type+" "+a.action;f=a.detail||a.description||"";g="http://stackoverflow.com/questions/"+a.post_id}b+='<a href="'+g+'" title="'+f+'">'+c+"</a>";return b};d.fn.lifestream.feeds.stackoverflow.parseStackOverflow=function(a){var b=[];if(a&&a.total&&a.total>0&&a.user_timelines)for(var c=0,f=a.user_timelines.length;c<f;c++){var g=a.user_timelines[c];b.push({date:new Date(g.creation_date*1E3),service:h.service,html:e(g)})}i(b)};
d.ajax({url:"http://api.stackoverflow.com/1.1/users/"+h.user+"/timeline?jsonp=$.fn.lifestream.feeds.stackoverflow.parseStackOverflow",dataType:"jsonp",crossDomain:true}).complete(i)};d.fn.lifestream.feeds.googlereader=function(h,i){d.ajax({url:k('select * from xml where url="www.google.com/reader/public/atom/user%2F'+h.user+'%2Fstate%2Fcom.google%2Fstarred"')}).success(function(e){if(typeof e==="string")e=d.parseJSON(e);var a=[];if(e.query&&e.query.count&&e.query.count>0){e=e.query.results.feed.entry;
for(var b=0,c=e.length;b<c;b++){var f=e[b];a.push({date:new Date(parseInt(f["crawl-timestamp-msec"],10)),service:h.service,html:'starred post <a href="'+f.link.href+'">'+f.title.content+"</a>"})}}i(a)})};d.fn.lifestream.feeds.defaultf=function(){}})(jQuery);
